---
import * as Content from "astro:content"

import Imports from "../../components/common_imports.astro"
import Metadata from "../../components/common_metadata.astro"
import Header from "../../components/header.astro"
import Footer from "../../components/footer.astro"
import AppsList from "../../components/apps_list.astro"
import Pagination from "../../components/pagination.astro"

import { live } from "../../validate_hosted_apps.js"

const characters = [ "1", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z" ]

export async function getStaticPaths() {
	const characters = [ "1", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z" ]
	return characters.map(page => ({
		params: { page },
})) }

let { page } = Astro.params

let packaged = await Content.getCollection("metadata", app => app.data.app_type != "hosted")

let apps = packaged.concat(live).filter(function(app) {
	let name = app.data.name["en-US"] ?? app.data.name.en ?? app.data.name[app.data.default_locale]
	let starting = name[0].toUpperCase()
	if(! characters.includes(starting)) {
		starting = "1"
	}
	return starting == page
})
---

<!doctype html>
<html lang="en">
	<head>
		<Imports/>
		<link rel="stylesheet" href="/lists.css">
		<link rel="stylesheet" href="/pagination.css">
		<script src="/pagination.js" defer></script>
		<Metadata/>
		<title>Page { page } - All Apps - FF Apps Archive</title>
		<link rel="canonical" href="/all/">
	</head>
	<body>
		<Header/>
		<main>
			<header>
				<h2>All Apps - Page { page }</h2>
			</header>
			<Pagination current={page} />
			<AppsList apps={ apps }/>
			<Pagination current={page} />
		</main>
		<Footer/>
	</body>
</html>